# CTIS TAXII ES Integration - TODO
### Unknowns
- [X] Logging: https://dev.splunk.com/enterprise/docs/developapps/addsupport/logging/loggingsplunkextensions
- [X] Read from kvstore collection
- [X] Write to kvstore collection
- [ ] Read config saved by UCC
### Misc
- [ ] Rename app package (without the '2')


### Features
- [X] Suggest a conversion from splunk_field=value => STIX2 Pattern
  - [X] Handle CIDR slash range for IPv4: e.g. 10.2.4.5/24 
- Test Automation
  - [ ] Splunk Docker
    - [ ] Selenium for form interaction
    - [ ] Python / pytest for hitting API endpoints
- [ ] New Indicator Form
    - [X] Autopopulate STIX pattern upon Splunk field name/value change (if text field is blank)
    - [X] Fix bug, clearing a text field with the 'x' doesn't clear the value
    - [X] Use TLP version 1: https://www.first.org/tlp/v1/
        - make sure form field says that it expecting TLPv1
        - seems to be just RED, AMBER, GREEN, WHITE
    - [X] Show form submission error as a red banner message
    - [ ] Populate Groupings dropdown from REST endpoint
    - [ ] Stretch feature: Event-level workflow action -> Add Multiple IOCs to Grouping
      - [ ] Modify form to accept one or more splunk key=value pairs which generate a STIX pattern
      - https://react-hook-form.com/docs/usefieldarray
- [ ] Indicator Model - REST API
    - [ ] Create
        - [X] Find a good library to handle JSON schema validation & maybe Dataclass compatibility
          - Using dataclasses-json which uses marshmallow under the hood for schema validation
        - [X] Schema versioning: to handle updates/breaking changes to the app
        - [ ] https://dev.splunk.com/enterprise/docs/developapps/manageknowledge/kvstore/usetherestapitomanagekv/ 
        - [ ] Nicely convert the ClassValidationError to a human-readable error message -> form submission errors
        - [ ] Validate indicator_id is unique & does not already exist
        - [ ] Validate grouping_id exists
        - [ ] New POST endpoint to validate a STIX pattern (realtime form validation)
        - [ ] Handle create multiple indicators in one submission
          - [ ] Accept a list of objects as payload
          - [ ] Validation -> nice error messages
    - [X] Read One
      - [X] Handled by list indicators endpoint, just use query set to {"indicator_id" :"XXX"}
          - [X] Consideration: Performance impact - reads entire collection to get total records
    - [X] List
      - [X] Query by keyword / regex on one or more fields
        - Use mongodb query format: e.g. for substring search: `{"field": {"$regex": "substring"}}`
        - Passthrough of JSON encoded "query" query parameter
      - [X] Pagination
        - [X] Backend to support return number of total results
    - [ ] Update
    - [ ] Delete
- [ ] Identity Model
    - [X] Create
    - [ ] Read One
    - [ ] List
    - [ ] Update
    - [ ] Delete
- [ ] Grouping Model
    - [ ] Create
    - [ ] Read One
    - [ ] List
    - [ ] Update
    - [ ] Delete
- [ ] Submissions
    - [ ] Read One
    - [ ] List
- [ ] Scheduled Submissions
    - [ ] Read One
    - [ ] List
      - [ ] Filter by status (submitted, pending, failed)
    - [ ] Delete/Cancel
- [ ] Submit grouping to TAXII
- [ ] Schedule submission of grouping to TAXII
- [ ] Schema Migration between app versions
  - [ ] R&D how to handle this
    - I'm thinking that we use a scheduled search that runs frequently to check for records using old schema version
    - Have some script to convert the old schema to the new schema (if possible)
    - What about breaking changes?
